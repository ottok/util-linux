From: Masatake YAMATO <yamato@redhat.com>
Date: Sat, 16 Mar 2024 22:20:00 +0900
Subject: tests: (lsfd) skip some cases if NETLINK_SOCK_DIAG for AF_UNIX is
 not available

Close #2822.

Signed-off-by: Masatake YAMATO <yamato@redhat.com>
---
 tests/ts/lsfd/mkfds-socketpair                     | 3 +++
 tests/ts/lsfd/mkfds-unix-stream-requiring-sockdiag | 2 ++
 2 files changed, 5 insertions(+)

diff --git a/tests/ts/lsfd/mkfds-socketpair b/tests/ts/lsfd/mkfds-socketpair
index 38f9279..3ef60c7 100755
--- a/tests/ts/lsfd/mkfds-socketpair
+++ b/tests/ts/lsfd/mkfds-socketpair
@@ -20,6 +20,7 @@ TS_DESC="AF_UNIX socket pair created with socketpair(2)"
 . "$TS_TOPDIR"/functions.sh
 ts_init "$*"
 
+. "$TS_SELF/lsfd-functions.bash"
 ts_check_test_command "$TS_CMD_LSFD"
 
 ts_check_test_command "$TS_HELPER_MKFDS"
@@ -28,6 +29,8 @@ ts_check_prog "sed"
 
 ts_cd "$TS_OUTDIR"
 
+lsfd_check_sockdiag "unix"
+
 PID=
 FD0=3
 FD1=4
diff --git a/tests/ts/lsfd/mkfds-unix-stream-requiring-sockdiag b/tests/ts/lsfd/mkfds-unix-stream-requiring-sockdiag
index c188464..6189d0d 100755
--- a/tests/ts/lsfd/mkfds-unix-stream-requiring-sockdiag
+++ b/tests/ts/lsfd/mkfds-unix-stream-requiring-sockdiag
@@ -28,6 +28,8 @@ ts_check_test_command "$TS_HELPER_MKFDS"
 
 ts_cd "$TS_OUTDIR"
 
+lsfd_check_sockdiag "unix"
+
 PID=
 FDS=3
 FDC=4
