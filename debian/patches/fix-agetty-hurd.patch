From: Samuel Thibault <samuel.thibault@ens-lyon.org>
Subject: Re: [ANNOUNCE] util-linux v2.33

See original message at:
https://lore.kernel.org/util-linux/20181106123402.cy52t2ql4yvfqme6@function/T/#m49ca4b0b1d014e33156801f8534145e15f90e749

This patch/attachment downloaded from:
https://lore.kernel.org/util-linux/20181106123402.cy52t2ql4yvfqme6@function/2-fix


Index: util-linux-2.33/term-utils/agetty.c
===================================================================
--- util-linux-2.33.orig/term-utils/agetty.c
+++ util-linux-2.33/term-utils/agetty.c
@@ -1768,6 +1768,7 @@ static void eval_issue_file(struct issue
 }
 #else /* ISSUE_SUPPORT */
 
+#ifdef AGETTY_RELOAD
 static int issue_is_changed(struct issue *ie)
 {
 	if (ie->mem_old && ie->mem
@@ -1780,6 +1781,7 @@ static int issue_is_changed(struct issue
 
 	return 1;
 }
+#endif
 
 static void print_issue_file(struct issue *ie,
 			     struct options *op,
@@ -2066,8 +2068,8 @@ static char *get_logname(struct issue *i
 		/* Write issue file and prompt */
 		do_prompt(ie, op, tp);
 
-#ifdef AGETTY_RELOAD
 	no_reload:
+#ifdef AGETTY_RELOAD
 		if (!wait_for_term_input(STDIN_FILENO)) {
 			/* refresh prompt -- discard input data, clear terminal
 			 * and call do_prompt() again
@@ -2731,6 +2733,7 @@ static void output_special_char(struct i
 			fprintf (ie->output, "%d ", users);
 		break;
 	}
+#if defined(RTMGRP_IPV4_IFADDR) && defined(RTMGRP_IPV6_IFADDR)
 	case '4':
 	case '6':
 	{
@@ -2754,6 +2757,7 @@ static void output_special_char(struct i
 			netlink_groups |= RTMGRP_IPV6_IFADDR;
 		break;
 	}
+#endif
 	default:
 		putchar(c);
 		break;
